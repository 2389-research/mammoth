{{define "content"}}
<link rel="stylesheet" href="/static/css/project-overview.css">

<section class="overview-shell">
    <section class="overview-hero">
        <div class="overview-hero-row">
            <div class="overview-hero-stack">
                <h1>{{.Project.Name}}</h1>
                <p>Created {{.Project.CreatedAt.Format "Jan 2, 2006 3:04 PM"}}</p>
            </div>
            <span class="web-phase-pill web-phase-{{.Project.Phase}}">{{.Project.Phase}}</span>
        </div>
    </section>

    <section class="overview-grid">
        <div class="overview-card">
            <h3>Spec</h3>
            <p>Shape intent, constraints, and decision points before generating pipeline DOT.</p>
            {{if .Project.SpecID}}
                <p class="web-note" style="margin-top: 8px; color: var(--success);">Spec initialized</p>
            {{end}}
            <div class="web-inline-actions">
                <a href="/projects/{{.Project.ID}}/spec" class="btn">
                    {{if eq (lower (print .Project.Phase)) "spec"}}Start Spec{{else}}View Spec{{end}}
                </a>
            </div>
            {{if .Project.SpecID}}
            <form method="POST" action="/projects/{{.Project.ID}}/spec/continue" style="margin-top: 8px;">
                <button type="submit" class="btn btn-primary">Generate DOT + Continue</button>
            </form>
            {{end}}
        </div>

        <div class="overview-card">
            <h3>Edit</h3>
            <p>Refine graph structure, inspect diagnostics, and tune execution prompts.</p>
            {{if .Project.DOT}}
                <p class="web-note" style="margin-top: 8px; color: var(--success);">DOT defined</p>
            {{end}}
            <div class="web-inline-actions">
                <a href="/projects/{{.Project.ID}}/editor" class="btn">
                    {{if eq (lower (print .Project.Phase)) "edit"}}Edit DOT{{else}}View DOT{{end}}
                </a>
            </div>
            {{if .Project.DOT}}
            <form method="POST" action="/projects/{{.Project.ID}}/build/start" style="margin-top: 8px;">
                <button type="submit" class="btn btn-primary">Continue to Build</button>
            </form>
            {{end}}
        </div>

        <div class="overview-card">
            <h3>Build</h3>
            <p>Execute with live telemetry, reconnect-safe event streams, and node-level progress.</p>
            {{if .Project.RunID}}
                <p class="web-note" style="margin-top: 8px; color: var(--success);">Run: {{.Project.RunID}}</p>
            {{end}}
            {{if eq (lower (print .Project.Phase)) "build"}}
                <div class="web-inline-actions">
                    <a href="/projects/{{.Project.ID}}/build" class="btn btn-primary">
                        {{if .Project.RunID}}Continue Building{{else}}View Build{{end}}
                    </a>
                </div>
            {{else if and (eq (lower (print .Project.Phase)) "done") .Project.RunID}}
                <div class="web-inline-actions">
                    <a href="/projects/{{.Project.ID}}/final" class="btn">Open Final Report</a>
                </div>
            {{else if not .Project.DOT}}
                <div class="web-inline-actions">
                    <a href="/projects/{{.Project.ID}}/editor" class="btn">Define DOT First</a>
                </div>
            {{else}}
                <form method="POST" action="/projects/{{.Project.ID}}/build/start" style="margin-top: 10px;">
                    <button type="submit" class="btn">Start Build</button>
                </form>
            {{end}}
        </div>
    </section>

    {{if .Project.Diagnostics}}
    <div class="card" style="margin-top: 2px;">
        <h3>Diagnostics</h3>
        {{if .Diagnostics.BuildBlocked}}
            <p class="web-note" style="margin-top:8px; color: var(--danger);">
                Build did not start: {{.Diagnostics.ErrorCount}} blocking error(s) found in DOT validation.
            </p>
            <p class="web-note" style="margin-top:4px;">
                Fix errors in the editor, then start build again.
            </p>
            {{if .Project.DOT}}
            <form method="POST" action="/projects/{{.Project.ID}}/dot/fix" style="margin-top: 10px;">
                <button type="submit" class="btn btn-primary">Fix DOT with Agent</button>
            </form>
            {{end}}
        {{else if gt .Diagnostics.WarningCount 0}}
            <p class="web-note" style="margin-top:8px; color: var(--warning);">
                No blocking errors. {{.Diagnostics.WarningCount}} warning(s) reported.
            </p>
        {{end}}
        {{if .Diagnostics.Errors}}
        <h4 style="margin: 12px 0 4px 0; color: var(--danger); font-size: 13px;">Errors</h4>
        <ul style="margin-top: 8px; padding-left: 18px;">
            {{range .Diagnostics.Errors}}
            <li class="web-note">{{.}}</li>
            {{end}}
        </ul>
        {{end}}
        {{if .Diagnostics.Warnings}}
        <h4 style="margin: 12px 0 4px 0; color: var(--warning); font-size: 13px;">Warnings</h4>
        <ul style="margin-top: 8px; padding-left: 18px;">
            {{range .Diagnostics.Warnings}}
            <li class="web-note">{{.}}</li>
            {{end}}
        </ul>
        {{end}}
        {{if .Diagnostics.Other}}
        <h4 style="margin: 12px 0 4px 0; font-size: 13px;">Other</h4>
        <ul style="margin-top: 8px; padding-left: 18px;">
            {{range .Diagnostics.Other}}
            <li class="web-note">{{.}}</li>
            {{end}}
        </ul>
        {{end}}
    </div>
    {{end}}
</section>
{{end}}
